<!--
 * @Author: Jandan
 * @Date: 2021-02-07 21:18:14
 * @LastEditTime: 2021-02-09 02:21:26
 * @Description:
-->
{extend name="layout" /} {block name="content"}
<button class="layui-btn layui-btn-normal create">添加</button>
<table id="LAY_table_user" class="layui-hide" lay-filter="LAY_table_user"></table>
<script type="text/html" id="LAY_table_user_rowToolTpl">
  <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">
    <i class="layui-icon layui-icon-edit"></i>
    编辑
  </a>
  <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">
    <i class="layui-icon layui-icon-delete"></i>
    删除
  </a>
</script>
<script>
  layui.use(['table', 'jquery'], function () {
    const table = layui.table,
      $ = layui.jquery

    // 表格渲染
    table.render({
      elem: '#LAY_table_user',
      url: "{:url('show')}",
      height: 500,
      cellMinWidth: 80,
      cols: [
        [
          { field: 'id', title: 'ID', sort: true },
          { field: 'username', title: '用户名' },
          {
            field: 'sex',
            title: '性别',
            sort: true,
            templet: function (data) {
              return data.sex === 1 ? '男' : '女'
            },
          },
          { fixed: 'right', title: '操作', toolbar: '#LAY_table_user_rowToolTpl', width: 150 },
        ],
      ],
      page: true,
    })
    // 监听行工具事件
    table.on('tool(LAY_table_user)', function (row) {
      const { data } = row
      if (row.event === 'edit') {
        layer.open({
          type: 2,
          area: ['700px', '450px'],
          fixed: false, //不固定
          maxmin: true,
          content: "{:url('edit')}" + '?id=' + data.id,
        })
      } else if (row.event === 'del') {
        $.ajax({
          url: "{:url('delete')}",
          data: { id: data.id },
          type: 'DELETE',
          success: function (response) {
            if (response.code === 0) {
              layer.msg(response.msg, { icon: 6, time: 1000 }, function () {
                table.reload('LAY_table_user')
              })
            } else {
              layer.alert(response.msg, { icon: 5 }, function (index) {
                layer.close(index)
              })
            }
          },
        })
      }
    })

    $('.create').click(function () {
      layer.open({
        type: 2,
        area: ['700px', '450px'],
        fixed: false, //不固定
        maxmin: true,
        content: "{:url('create')}",
      })
    })
  })
</script>
{/block}
